{% extends "base.html" %}
{% from "macros.html" import render_item, render_status, render_tag %}

{% block breadcrumb %}
<li>{{ g.project.name }}</li>
{% endblock %}

{% block content %}

<div class="panel panel-primary">
    <div class="panel-heading">Project details</div>
    <div class="panel-body">
    <table class="table">
    <tbody>
        <tr>
        <th>Name</th> <td>{{ g.project.name }}</td>
        </tr>
        <tr>
        <th>List address</th>
        <td>{{ g.project.listemail }}</td>
        </tr>
        <tr>
        <th>Maintainers</th>
        <td>
            <ul class="list-inline">
            {%- for m in g.project.maintainers %}
                <li>
                    <a href="{{ url_for('profile', user_name=m.name) }}">
                        {{ m.name }}</a>&nbsp;
                    <a href="mailto:{{ m.email }}">
                        <span class="glyphicon glyphicon-envelope"></span>
                    </a>
                </li>
            {% endfor %}
            </ul>
        </td>
        </tr>
        <tr>
            <th>Patch count</th>
            <td>
            {{ render_status(g.project) }}
            </td>
        </tr>
        <tr>
            <th>Tags</th>
            <td>
                <a href="#" data-toggle="collapse" data-target="#taglist">
                {{ g.project.tags.count() }}
                </a>
            </td>
        <tr>
            <td colspan=2>
                <div class="collapse" id="taglist">
                    {% for tag in g.project.tags %}
                        {{render_tag(tag, g.project)}}
                    {% endfor %}
                </div>
            </td>
        </tr>

        {{ render_item("Website", g.project.web_url) }}
        {{ render_item("Source Code Web Interface",  g.project.webscm_url) }}
        {{ render_item("Source Code Manager URL", g.project.scm_url) }}
        </tr>
    </tbody>
    </table>
    </div>
</div>


{%- macro patch_row_tiny(patch) -%}
    <tr>
        <td>
            <a href="{{url_for('patch.index', patch_id=patch.id)}}">
                {{ patch.name| truncate(79, True) }}
            </a>
        </td>
        <td>
            {{ patch.date }}
        </td>
        <td>
            {{ patch.state }}
        </td>
    </tr>
{% endmacro %}

{%- macro patch_panel(highlight, heading, data, pagination_arg) -%}
    {%- if data.items.count -%}
    <div class="panel panel-{{highlight}}">
        <div class="panel-heading">{{heading}}</div>
        <table class="table table-striped">
        <thead>
            <tr>
                <th>Patch</th><th>Date</th><th>State</th>
            </tr>
        </thead>
        <tbody>
        {%- for patch in data.items %}
            {{ patch_row_tiny(patch) }}
        {% endfor %}
        </tbody>
        </table>
    </div>
    {% endif %}
    {%- if data.has_prev  -%}
        <a href="{{ url_for('project.index', **{pagination_arg:data.page-1}) }}">Prev page</a>
    {% else %}
        <i>No prev page</i>
    {% endif %}
    - Page {{ data.page }} -
    {%- if data.has_next  -%}
        <a href="{{ url_for('project.index', **{pagination_arg:data.page+1}) }}">Next page</a>
    {% else %}
        <i>No next page</i>
    {% endif %}
    <br/><br/>
{% endmacro %}


{{ patch_panel('danger', "Stale Patches", g.project.stale_patches.paginate(stale_page, per_page=10), 'stale_page') }}

{{ patch_panel('info', "New Patches", g.project.new_patches.paginate(new_page, per_page=10), 'new_page' ) }}

{% endblock %}
